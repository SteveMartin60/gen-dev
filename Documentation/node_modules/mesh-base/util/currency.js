//..............................................................................
const {util} = cxq;
//..............................................................................

//..............................................................................
const {isDefined, addProperties, functionAsProperty_ReadOnly, roundN} = util;
//..............................................................................

//..............................................................................
var currency = 'USD';
//..............................................................................

//..............................................................................
function getCurrency()
{
    return currency;
}
//..............................................................................

//..............................................................................
function setCurrency(newCurrency)
{
    if (isDefined(newCurrency))
        currency = newCurrency;
}
//..............................................................................

//..............................................................................
function convertCurrency(value, sourceCurrencyId, targetCurrencyId, round=4)
{
    var sourceCurrency, targetCurrency, sourceRate, targetRate;
    var otherValue = value;

    const {currencies} = cxq;

    if (targetCurrencyId == sourceCurrencyId || !isDefined(targetCurrencyId))
        return otherValue;

    //Central Currency is USD
    // So first need to covert to that (which is currency's own rate)
    //    then  convert to other using other currency's rate

    sourceCurrency = currencies[sourceCurrencyId];
    targetCurrency = currencies[targetCurrencyId];

    if (sourceCurrency && targetCurrency)
    {
        sourceRate = sourceCurrency.rate;
        targetRate = targetCurrency.rate;

        if (isDefined(sourceRate) && isDefined(targetRate))
        {
            otherValue = (otherValue / sourceRate ); //Convert to base currency
            otherValue = (otherValue * targetRate); //Convert to target currency
            otherValue = roundN(otherValue,round);
            return otherValue;
        }
        else
        {
            console.error('CurrencyWithNoRate:',targetCurrencyId);
            return null;
        }
    }
    else
    {
        console.error('BadCurrency:',targetCurrencyId);
        return null;
    }
}
//..............................................................................

addProperties(util,
{
    getCurrency,
    setCurrency,
    convertCurrency
});


